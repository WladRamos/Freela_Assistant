{% extends "assistant/layout.html" %}
{% load static %}

{% block css %}
  <link rel="stylesheet" href="{% static 'assistant/styles/styles.css' %}">
  <link rel="stylesheet" href="{% static 'assistant/styles/profile.css' %}">
{% endblock %}

{% block content %}
  {% if user.is_authenticated %}
    <div class="profile-container">
      <div class="profile-header">
        <img src="{% static 'assistant/images/user-icon.png' %}" alt="User Icon" class="user-icon">
        <h1>Perfil de {{ user.username }}</h1>
      </div>

      <section class="profile-section">
        <h2>Histórico de Trabalhos</h2>
        <div class="profile-box">
          {% for projeto in user.projetos.all %}
            <p class="work-title" data-id="{{ projeto.id }}">{{ projeto.titulo }}</p>
          {% empty %}
            <p>Nenhum trabalho cadastrado.</p>
          {% endfor %}
          <button class="primary-btn" id="add-work">Adicionar Trabalho</button>
        </div>
      </section>

      <!-- Modal -->
      <div id="work-modal" class="modal hidden">
        <div class="modal-content">
          <h3 id="work-modal-title">Detalhes do Trabalho</h3>
          <form id="work-form">
            <input type="hidden" id="work-id">

            <label for="work-title">Título:</label>
            <input type="text" id="work-title" disabled>

            <label for="work-description">Descrição:</label>
            <textarea id="work-description" disabled></textarea>

            <label for="work-payment">Tipo de Pagamento:</label>
            <select id="work-payment" disabled>
              <option value="Hora">Hora</option>
              <option value="Fixo">Fixo</option>
            </select>

            <label for="work-value">Valor:</label>
            <input type="number" id="work-value" disabled>

            <label>Habilidades:</label>
            <div id="work-skills" class="skill-container"></div>

            <!-- Campo de adicionar nova habilidade -->
            <div id="add-skill-container" class="hidden">
              <input type="text" id="new-work-skill" placeholder="Adicionar habilidade">
              <button type="button" class="primary-btn" id="add-work-skill">Adicionar</button>
            </div>

            <div class="modal-actions">
              <button type="button" class="gray-btn close" onclick="fecharModal()">Fechar</button>
              <button type="button" class="gray-btn" id="edit-work">Editar</button>
              <button type="button" class="primary-btn" id="save-work" style="display: none;">Salvar</button>
              <button type="button" class="delete-btn" id="delete-work">Excluir</button>
            </div>
          </form>
        </div>
      </div>

      <section class="profile-section">
        <h2>Preferências de Preços</h2>
        <div class="profile-box">
          <p>Preço Fixo: $ <input type="number" name="preco_fixo_min" value="{{ user.preco_fixo_min }}"></p>
          <p>Preço por hora: $ <input type="number" name="preco_hora_min" value="{{ user.preco_hora_min }}"></p>
          <button class="primary-btn" id="save-prices">Salvar Preços</button>
        </div>
      </section>

      <section class="profile-section">
        <h2>Habilidades</h2>
        <div class="profile-box skills">
          {% for habilidade in user.habilidades.all %}
            <span class="skill-tag" data-id="{{ habilidade.habilidade.id }}">{{ habilidade.habilidade.nome }} <span class="remove-skill">x</span></span>
          {% empty %}
            <p>Nenhuma habilidade cadastrada.</p>
          {% endfor %}
          <button class="add-skill-btn" id="add-skill">+</button>
        </div>
      </section>

      <!-- Modal de Habilidade -->
      <div id="skill-modal" class="modal hidden">
        <div class="modal-content">
          <span class="close">&times;</span>
          <h3>Adicionar Habilidade</h3>
          <input type="text" id="new-skill" placeholder="Digite uma habilidade">
          <button type="button" class="primary-btn" id="save-skill">Adicionar</button>
        </div>
      </div>
    </div>
  {% else %}
    <h1>Você precisa estar logado para acessar esta página.</h1>
  {% endif %}
{% endblock %}

{% block script %}
  <script src="{% static 'assistant/scripts/profile.js' %}"></script>
{% endblock %}
